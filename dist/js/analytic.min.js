/*
 server 2016-11-17 
*/
function enableRunButton(){"button-error"==$("#start-button").attr("class")&&$("#start-button").toggleClass("button-error button-success"),$("#start-button").prop("disabled",!1)}function disableRunButton(){"button-success"==$("#start-button").attr("class")&&$("#start-button").toggleClass("button-error button-success"),$("#start-button").prop("disabled",!0)}function classifyAllData(a){showLoadingAnimation(),$.post(web_server_address+"/classify_all",a,function(a,b){var c=a.split("\n");group_unlabeled_geojson_trajectories.clearLayers(),delete window.group_unlabeled_geojson_trajectories,delete window.unlabeled_leaflet_geojson_trajectories,trajectories_map=[],c.forEach(function(a,b,c){if(a){var d=JSON.parse(a);trajectories_map[d.tid]=createGeojsonTrajectory(d,line_layer_default_style),trajectories_map[d.tid].label=d.label}}),updateSummary(),setNextStepMessage("All trajectories were succesfully classified. For a new simulation please load a dataset."),disableRunButton(),refreshLayers(),hideLoadingAnimation(),$("#bottom-nav").hide(),$("#results-nav").show(),updateMapBounds(),createResultsCharts()})}function clearUnlabeledTrajectories(){for(var a in trajectories_map){var b=trajectories_map[a].label;"unlabeled"==b&&delete trajectories_map[a]}}function runActiveLearning(a){showLoadingAnimation(),$.post(web_server_address+"/al_run",a,function(a,b){var c=a.split("\n");group_unlabeled_geojson_trajectories.clearLayers(),delete window.group_unlabeled_geojson_trajectories,delete window.unlabeled_leaflet_geojson_trajectories,unlabeled_items_key=[],clearUnlabeledTrajectories(),c.forEach(function(a,b,c){if(a){var d=JSON.parse(a);trajectories_map[d.tid]=createGeojsonTrajectory(d,line_layer_default_style),trajectories_map[d.tid].label="unlabeled",unlabeled_items_key.push(d.tid)}}),refreshLayers(),updateSummary(),hideLoadingAnimation(),setNextStepMessage("Please provide a label to each trajectory remaining (in red) on the map."),disableRunButton(),previous_remaining_from_budget=parseInt($("#remaining-budget").text()),updateMapBounds()})}function updateSummary(){var a=parseInt($("#nof-trajectories").text())-parseInt($("#total-labeled").text());$("#remaining").text(a);var b=parseInt($("#total-budget").val())-parseInt($("#total-labeled").text());$("#remaining-budget").text(b)}function convertObjectMapToArray(a){var b=[];for(var c in a)b.push(a[c]);return b}function setNextStepMessage(a){$("#next-step-message").fadeOut("slow"),$("#next-step-message").empty();var b=" "+a;$("#next-step-message").append(b),$("#next-step-message").fadeIn("slow").delay(2e3)}function rotate(a,b){for(;b--;){var c=a.shift();a.push(c)}return a}function createResultsCharts(){var a={},b=[],c=[],d=[],c=[],e=$("#middle-left-nav").css("height").replace("px",""),f=$("#middle-left-nav").css("width").replace("px",""),g=parseFloat(f/2),h=parseFloat(e/2);for(var i in trajectories_map){var j=trajectories_map[i].label;if("unlabeled"!=j){var k=trajectories_map[i]._layers;b.hasOwnProperty(j)||(b[j]=[]),b[j].push(trajectories_map[i]);for(var l in k)if("undefined"==typeof a[j]&&(a[j]={}),k.hasOwnProperty(l)){var m=k[l].feature;for(var n in m.properties)m.properties.hasOwnProperty(n)&&("undefined"==typeof c[n]&&(c[n]=n),"undefined"==typeof a[j][i]&&(a[j][i]={}),"undefined"==typeof a[j][n]&&(a[j][i][n]={}),a[j][i][n]=m.properties[n])}}}for(var o in b)d[o]=b[o].length;$("#feature-selector").empty();for(n in c)$("#feature-selector").append("<option val='"+n+"'>"+n+"</option>");var n=$("#feature-selector option:selected").text();$("#feature-selector").change(function(){console.log("changed!");var b=$("#feature-selector option:selected").text();$("#trajectory-features-distribution-chart").empty(),google.charts.setOnLoadCallback(drawHistogramTrajectoryFeaturesDistribution(a,b,g,h))}),google.charts.setOnLoadCallback(drawHistogramTrajectoryFeaturesDistribution(a,n,g,h)),google.charts.setOnLoadCallback(drawStackedLabelsDistribution(d,g,h+17))}function drawHistogramTrajectoryFeaturesDistribution(a,b,c,d){var e=[],f=[],g={},h=0,i=[];for(label in a)if(a.hasOwnProperty(label)){f.push(label),g[label]=h;var j=$("#color-"+label).val();i.push(j),h++}e.push(f);for(label in a)if(a.hasOwnProperty(label))for(tid in a[label]){for(var k=[],l=0;l<h;l++)k.push(null);var m=parseFloat(a[label][tid][b]);k[g[label]]=trunc(m),e.push(k)}var n=google.visualization.arrayToDataTable(e),o={title:"Trajectory features distribution",titleTextStyle:{fontSize:16,bold:!0},legend:{position:"none"},colors:i,interpolateNulls:!1,isStacked:!0,hAxis:{title:"Feature value"},vAxis:{title:"Number of items",viewWindowMode:"explicit",viewWindow:{min:0}},histogram:{hideBucketItems:!1}},p=new google.visualization.Histogram(document.getElementById("trajectory-features-distribution-chart"));p.draw(n,o)}function drawStackedLabelsDistribution(a,b,c){var d=[];d.push(["Label","Number of trajectories",{role:"style"}]);for(key in a){var e=$("#color-"+key).val();d.push([key,a[key],e])}var f=google.visualization.arrayToDataTable(d),g={title:"Labels distribution",titleTextStyle:{fontSize:16,bold:!0},legend:{position:"none"},hAxis:{title:"Label name"},vAxis:{title:"Number of trajectories",viewWindowMode:"explicit",viewWindow:{min:0}}},h=new google.visualization.ColumnChart(document.getElementById("labels-distribution"));h.draw(f,g)}function setStrategy(a){$("#al-strategy-name").text(a),hide_al_dropdown()}function setClassifier(a){$("#classifier-name").text(a),hide_classifier_dropdown()}function setTopMessage(a,b){$("#alert-message-nav").empty();var c='<div class="alert '+b+'"> <span class="closebtn">&times;</span>'+a+"</div>";$("#alert-message-nav").append(c),$("#alert-message-nav").fadeIn(1e3).delay(3e3).fadeOut(1e3),$(".closebtn").click(function(){$("#alert-message-nav").hide();var a=this.parentElement;a.style.opacity="0",setTimeout(function(){a.style.display="none"},600)})}function show_classifier_dropdown(){hide_data_dropdown(),hide_al_dropdown(),document.getElementById("classifiers-dropdown").classList.remove("hide"),document.getElementById("classifiers-dropdown").classList.toggle("show")}function hide_classifier_dropdown(){document.getElementById("classifiers-dropdown").classList.remove("show"),document.getElementById("classifiers-dropdown").classList.toggle("hide")}function show_al_dropdown(){hide_data_dropdown(),hide_classifier_dropdown(),document.getElementById("al-dropdown").classList.remove("hide"),document.getElementById("al-dropdown").classList.toggle("show")}function hide_al_dropdown(){document.getElementById("al-dropdown").classList.remove("show"),document.getElementById("al-dropdown").classList.toggle("hide")}function show_data_dropdown(){hide_al_dropdown(),hide_classifier_dropdown(),document.getElementById("databases-dropdown").classList.remove("hide"),document.getElementById("databases-dropdown").classList.toggle("show")}function hide_data_dropdown(){document.getElementById("databases-dropdown").classList.remove("show"),document.getElementById("databases-dropdown").classList.toggle("hide")}function initializeMap(){return L.mapbox.tileLayer("mapbox.streets").addTo(map),map}function createLayerStyle(a){var b={color:a,weight:3,opacity:.6,fillOpacity:.2,fillColor:a};return b}function refreshLayers(){clearAllLayers();var a=[],b=[];console.log("refresh");for(var c in trajectories_map){var d=trajectories_map[c].label;"unlabeled"==d?a.push(trajectories_map[c]):(b.hasOwnProperty(d)||(b[d]=[]),b[d].push(trajectories_map[c]))}group_unlabeled_geojson_trajectories=insertTrajectoriesInMap(a,group_unlabeled_geojson_trajectories);for(var c in b){var e=$("#color-"+c).val(),f={color:e,weight:3};group_labeled_geojson_trajectories[c]=insertTrajectoriesInMap(b[c],group_labeled_geojson_trajectories[c]),group_labeled_geojson_trajectories[c].setStyle(f)}group_unlabeled_geojson_trajectories.bringToBack()}function clearAllLayers(){group_labeled_geojson_trajectories=[],map.eachLayer(function(a){map.removeLayer(a)}),map=initializeMap()}function setDefaults(){clearAllLayers(),group_unlabeled_geojson_trajectories&&delete window.group_unlabeled_geojson_trajectories,delete window.group_labeled_geojson_trajectories,delete window.labeled_trajectories,delete window.trajectories_map,delete window.al_strategy,delete window.classifier,delete window.dataset,delete window.previous_remaining_from_budget,group_labeled_geojson_trajectories=[],map_label_index={},nextIndex=0,labeled_trajectories=[],feat_selector_list=[],$("#labels-colors").empty(),$("#add-new-label").prop("disabled",!0),$("#next-trajectory").prop("disabled",!0),$("#start-button").prop("disabled",!0),$("#add-label-to-trajectory").prop("disabled",!0),document.getElementById("add-new-label").className="button-error",document.getElementById("start-button").className="button-error",document.getElementById("add-label-to-trajectory").className="button-error",$("#label-selector").find("option").remove().end(),total_bound=0,first_time=!0,$("#results-nav").hide(),$("#bottom-nav").show()}function nextStepBlinking(a){$(a).animate({opacity:.4},700,"linear",function(){$(this).animate({opacity:1},500),$(this).animate({opacity:.4},700),$(this).animate({opacity:1},500),$(this).animate({opacity:.4},700),$(this).animate({opacity:1},500),$(this).animate({opacity:.4},700),$(this).animate({opacity:1},500),$(this).animate({opacity:.4},700),$(this).animate({opacity:1},500)})}function loadDataset(a){setDefaults(),$("#feats").remove(),readGeojsonData("/data/"+a)}function showLoadingAnimation(){$("#map").hide(),$("#loading").css("display","inline-block")}function hideLoadingAnimation(){$("#loading").hide(),$("#map").css("display","inline-block")}function readGeojsonData(a){group_unlabeled_geojson_trajectories&&group_unlabeled_geojson_trajectories.clearLayers(),jQuery.isEmptyObject(group_labeled_geojson_trajectories)&&group_labeled_geojson_trajectories.forEach(function(a,b,c){group_labeled_geojson_trajectories[b].clearLayers()}),showLoadingAnimation(),hide_data_dropdown(),$.get(web_server_address+a,function(a){var b=a.split("\n");trajectories_map=[],unlabeled_items_key=[],$("#nof-trajectories").text(b.length),b.forEach(function(a,b,c){if(a){var d=JSON.parse(a);trajectories_map[d.tid]=createGeojsonTrajectory(d,line_layer_default_style),trajectories_map[d.tid].label="unlabeled",unlabeled_items_key.push(d.tid)}}),refreshLayers(),$("#add-new-label").toggleClass("button-error button-success"),$("#add-new-label").prop("disabled",!1);var c="Please add at least two class labels in the Manage labels panel";setNextStepMessage(c),hideLoadingAnimation(),setTopMessage("Dataset loaded with success!","success"),updateMapBounds(),nextStepBlinking("#add-new-label")})}function insertTrajectoriesInMap(a,b){return b=L.featureGroup(a),b.addTo(map),b}function updateMapBounds(){for(key in trajectories_map)if(group=trajectories_map[key],"undefined"==typeof total_bound||0==total_bound)total_bound=group.getBounds(),map.fitBounds(total_bound);else{var a=total_bound.extend(group.getBounds());map.fitBounds(a)}}function createGeojsonTrajectory(a,b){var c=L.geoJson(a,b);return c.on("click",function(a){var b;if("undefined"==typeof a.layer){var c=a.target._layers;for(key in c)b=c[key]}else b=a.layer;var d=L.featureGroup([this]);d.addTo(map),map.fitBounds(d.getBounds()),showTrajectoryFeatures(b),showPointFeatures(b)}),c}function createLineStringWithGradients(a,b){var c=[];a.forEach(function(a,b,d){var e=L.latLng(a.geometry.coordinates[1],a.geometry.coordinates[0]);e.meta=a.properties,c.push(e)});var d=(c.length,L.multiOptionsPolyline(c,{multiOptions:{optionIdxFn:function(a){var c,d=[],e=(this.max[b]-this.min[b])/4,f=(this.min[b]+e)/2;d.push(f);for(var g=1;g<4;g++)f+=e,d.push(f);for(c=0;c<d.length;++c)if(a.meta[b]<=d[c])return c;return d.length},options:[{color:"#FFCCCC"},{color:"#FF9999"},{color:"#FF4C4C"},{color:"#FF0000"},{color:"#CC0000"}]},weight:5,smoothFactor:1}));"undefined"!=typeof selected_trajectory_color_gradient&&map.removeLayer(selected_trajectory_color_gradient),selected_trajectory_color_gradient=d,d.addTo(map),"undefined"!=typeof selected_trajectory_arrows&&map.removeLayer(selected_trajectory_arrows);var e=L.polyline(c,{}),f=L.polylineDecorator(e,{patterns:[{offset:0,repeat:"10%",symbol:L.Symbol.arrowHead({pixelSize:12,polygon:!1,pathOptions:{stroke:!0,color:"#FF0000",weight:3}})}]});selected_trajectory_arrows=f,f.addTo(map);var g=0;window.setInterval(function(){f.setPatterns([{offset:g+"%",repeat:"10%",symbol:L.Symbol.arrowHead({pixelSize:12,polygon:!1,pathOptions:{stroke:!0,color:"#FF0000",weight:3}})}]),++g>20&&(g=0)},200);"undefined"!=typeof selected_trajectory_points&&selected_trajectory_points.forEach(function(a,b,c){map.removeLayer(a)})}function unselectTrajectory(a){a.options.fillOpacity=.2,a.options.weight=3,a.setStyle(a.options)}function showPointFeatures(a){var b={};a.feature.points.forEach(function(a,c,d){for(var e in a.properties)e in b||(b[e]=[]),b[e].push(a.properties[e])});var c=Object.keys(b);$("#point-feature-selector").show(),$("#point-feature-selector").empty();for(var d=0;d<c.length;d++){var e=c[d];$("#point-feature-selector").append("<option val='"+e+"'>"+e+"</option>")}$("#point-feature-selector").change(function(){var c=$("#point-feature-selector option:selected").text();$("#point-feat-line-chart").empty(),google.charts.setOnLoadCallback(drawPointFeatures(b,c)),createLineStringWithGradients(a.feature.points,c)}),google.charts.setOnLoadCallback(drawPointFeatures(b,e)),createLineStringWithGradients(a.feature.points,e)}function drawPointFeatures(a,b){var c=[];c.push(["PID","Value"]),a[b].forEach(function(a,b,d){c.push([b,a])});var d=google.visualization.arrayToDataTable(c),e={width:"100%",hight:"100%",titleTextStyle:{fontSize:16,bold:!0},colors:["red"],legend:{position:"none"},hAxis:{title:"PID"},vAxis:{title:"Value"}},f=new google.visualization.LineChart(document.getElementById("point-feat-line-chart"));f.draw(d,e)}function showTrajectoryFeatures(a){var b=$("#features-tbl");b.empty(),b.append("<dl id='tid' tid_val="+a.feature.tid+' class="inline">tid: <dt>'+a.feature.tid+"</dt></dl>");for(var c in a.feature.properties)b.append('<dl class="inline">'+c+": <dt>"+trunc(a.feature.properties[c])+"</dt></dl>")}function trunc(a){return Math.floor(100*a)/100}$("#add-new-label").click(function(a){a.preventDefault();var b=$("#label-txt").val().split(" ").join("-");if(!b){var c="Error! Please add a name to the label.";return void setTopMessage(c,"error")}if(0==$("#label-selector option[val='"+b+"']").length){$("#label-selector").append("<option val='"+b+"'>"+b+"</option>"),$("#label-txt").val("");var c="Success! Label added to the list.";setTopMessage(c,"success"),$("#label-selector option").size()>=2&&("button-error"==$("#add-label-to-trajectory").attr("class")&&$("#add-label-to-trajectory").toggleClass("button-error button-success"),$("#add-label-to-trajectory").prop("disabled",!1),"button-error"==$("#next-trajectory").attr("class")&&$("#next-trajectory").toggleClass("button-error button-success"),$("#next-trajectory").prop("disabled",!1),setNextStepMessage("Please add a label of each class to a trajectory for starting running an Active Learning strategy."),nextStepBlinking("#next-trajectory"),nextStepBlinking("#add-label-to-trajectory"));var d=layer_colors[$("#label-selector option").size()-1],e="color-"+b,f="<input id="+e+' type="color" name="favcolor" value="'+d+'">',g='<input type="checkbox" id="checkbox_'+b+'" checked>',h="<dl><b>"+b+":</b>"+f+" "+g+"</dl>";$("#labels-colors").append(h),$("#"+e).change(function(){var a=createLayerStyle($("#"+e).val());group_labeled_geojson_trajectories[b].setStyle(a)}),$("#checkbox_"+b).change(function(){$(this).is(":checked")?"undefined"!=typeof group_labeled_geojson_trajectories[b]&&group_labeled_geojson_trajectories[b].addTo(map):map.removeLayer(group_labeled_geojson_trajectories[b])})}else{var c="Error! Label <u>"+b+"</u> is already in the list.";setTopMessage(c,"error")}}),$("#start-button").click(function(){var a=parseInt($("#remaining-budget").text());$("#time-step").prop("disabled",!0),$("#total-budget").prop("disabled",!0);var b={};al_strategy?b.strategy=al_strategy:b.strategy="Random Sampling",classifier?b.classifier=classifier:b.classifier="Logistic Regression",b.dataset=dataset;var c=parseInt($("#remaining-budget").text()),d=parseInt($("#time-step").val());first_time?(b.time_step=d,first_time=!1):c-d>=0?b.time_step=d:b.time_step=c,b.labeled_trajectories=convertObjectMapToArray(labeled_trajectories),b=JSON.stringify(b),0==a?(b.classify_all=!0,classifyAllData(b)):(b.classify_all=!1,runActiveLearning(b))}),$("#unlabeled-color").change(function(){var a=createLayerStyle($("#unlabeled-color").val());group_unlabeled_geojson_trajectories.setStyle(a),group_unlabeled_geojson_trajectories.bringToBack()});var selected_item_key;$("#next-trajectory").click(function(a){return a.preventDefault(),"undefined"==selected_item_key?0:(unlabeled_items_key=rotate(unlabeled_items_key,1),void trajectories_map[unlabeled_items_key[0]].fire("click"))}),$("#add-label-to-trajectory").click(function(a){a.preventDefault();var b=$("#tid")[0].attributes.tid_val.value,c=$("#label-selector option:selected").text(),d={};map_label_index.hasOwnProperty(c)||(map_label_index[c]=nextIndex,nextIndex++),d.tid=Number(b),d.label_value=c,labeled_trajectories[b]=d;var e=createLayerStyle($("#color-"+c).val());trajectories_map[d.tid].label=c,refreshLayers(),group_labeled_geojson_trajectories[c].setStyle(e);var f=Object.keys(labeled_trajectories).length;$("#total-labeled").text(f),nextIndex>1&&first_time&&(enableRunButton(),setNextStepMessage("Click on the Run button in the Active Learning panel to start."),nextStepBlinking("#start-button")),updateSummary();var g=previous_remaining_from_budget-parseInt($("#time-step").val()),h=parseInt($("#remaining-budget").text());first_time||(g==parseInt($("#remaining-budget").text())?(enableRunButton(),setNextStepMessage("Click on the Run button in the Active Learning panel to run the selected strategy."),nextStepBlinking("#start-button")):0==h&&(enableRunButton(),setNextStepMessage("Click on the Run button to classify all trajectories."),nextStepBlinking("#start-button"))),setTopMessage("Label <b>"+c+"</b> succesfully added to trajectory id (tid) <b>"+b+"</b>","success"),$("#next-trajectory").click()}),google.charts.load("current",{packages:["corechart","bar"]});var values_by_label_and_feature=[];$(window).resize(function(){labeled_trajectories.length>1&&createResultsCharts()}),$("#rnd").click(function(){al_strategy="Random Sampling",setStrategy(al_strategy)}),$("#unc").click(function(){al_strategy="Uncertain Sampling",setStrategy(al_strategy)}),$("#qbc").click(function(){al_strategy="Query-by-committee",setStrategy(al_strategy)}),$("#lr").click(function(){classifier="Logistic Regression",setClassifier(classifier)}),$("#gnb").click(function(){classifier="Gaussian Naive Bayes",setClassifier(classifier)}),$("#dt").click(function(){classifier="Decision Tree",setClassifier(classifier)}),$("#knn").click(function(){classifier="KNN",setClassifier(classifier)}),$("#ab").click(function(){classifier="Ada Boost",setClassifier(classifier)}),$("#rf").click(function(){classifier="Random Forest",setClassifier(classifier)}),$("#fishing").click(function(){dataset="fishing",loadDataset(dataset)}),$("#geolife").click(function(){dataset="geolife",loadDataset(dataset)}),$("#hurricanes").click(function(){dataset="hurricanes",loadDataset(dataset)}),$("#load-data").click(function(){show_data_dropdown()}),nextStepBlinking("#load-data"),$("#al-strategy").click(function(){show_al_dropdown()}),$("#classifier").click(function(){show_classifier_dropdown()});var trajectories_map,al_strategy,classifier,dataset,group_unlabeled_geojson_trajectories,previous_remaining_from_budget,total_bound=0,first_time=!0,group_labeled_geojson_trajectories=[],unlabeled_items_key=[],selected_trajectory_color_gradient,selected_trajectory_arrows,selected_trajectory_points,map_label_index={},nextIndex=0,labeled_trajectories=[],web_server_address="http://206.167.183.217:80",default_unlabeled_color="#FF0000",line_layer_default_style=createLayerStyle(default_unlabeled_color),layer_colors=[];layer_colors.push("#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF"),L.mapbox.accessToken="pk.eyJ1IjoiYW1pbGNhcnNqIiwiYSI6ImNpdHAyODc2cDAwM2ozM21vZGQwMnUxNmYifQ.kxDj2-uHVNpfIuZVuJ-1FQ";var map=L.mapbox.map("map","mapbox.streets").setView([0,0],2);map=initializeMap(),$("#results-nav").hide(),setNextStepMessage("Please select a database!"),window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser."),function(){"use strict";L.MultiOptionsPolyline=L.FeatureGroup.extend({_getMin:function(a){var b={};for(key in a[0].meta)a.forEach(function(a,c,d){"undefined"==typeof b[key]?b[key]=a.meta[key]:a.meta[key]<b[key]&&(b[key]=a.meta[key])});this.min=b},_getMax:function(a){var b={};for(key in a[0].meta)a.forEach(function(a,c,d){"undefined"==typeof b[key]?b[key]=a.meta[key]:a.meta[key]>b[key]&&(b[key]=a.meta[key])});this.max=b},initialize:function(a,b){var c=b.multiOptions.copyBaseOptions;this._layers={},this._options=b,(void 0===c||c)&&this._copyBaseOptions(),this._getMin(a),this._getMax(a),this.setLatLngs(a)},_copyBaseOptions:function(){var a,b,c=this._options.multiOptions,d=c.options,e=d.length;for(a=L.extend({},this._options),delete a.multiOptions,b=0;b<e;++b)d[b]=L.extend({},a,d[b])},setLatLngs:function(a){var b,c,d,e,f=a.length,g=this._options.multiOptions,h=g.optionIdxFn,i=g.fnContext||this;for(this._originalLatlngs=a,this.eachLayer(function(a){this.removeLayer(a)},this),b=1;b<f;++b)d=h.call(i,a[b],a[b-1],b,a),console.log(d),1===b&&(e=[a[0]],c=h.call(i,a[0],a[0],0,a)),e.push(a[b]),c===d&&b!==f-1||("function"==typeof g.options?this.addLayer(new L.Polyline(e,g.options(c))):this.addLayer(new L.Polyline(e,g.options[c])),c=d,e=[a[b]]);return this},getLatLngs:function(){return this._originalLatlngs},getLatLngsSegments:function(){var a=[];return this.eachLayer(function(b){a.push(b.getLatLngs())}),a}}),L.multiOptionsPolyline=function(a,b){return new L.MultiOptionsPolyline(a,b)}}(),L.LineUtil.PolylineDecorator={computeAngle:function(a,b){return 180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI+90},getPointPathPixelLength:function(a){var b=a.length;if(b<2)return 0;for(var c,d=0,e=a[0],f=1;f<b;f++)d+=e.distanceTo(c=a[f]),e=c;return d},getPixelLength:function(a,b){var c=a instanceof L.Polyline?a.getLatLngs():a,d=c.length;if(d<2)return 0;for(var e,f=0,g=b.project(c[0]),h=1;h<d;h++)f+=g.distanceTo(e=b.project(c[h])),g=e;return f},projectPatternOnPath:function(a,b,c,d,e){var f,g=[];for(f=0,l=a.length;f<l;f++)g[f]=e.project(a[f]);var h=this.projectPatternOnPointPath(g,b,c,d);for(f=0,l=h.length;f<l;f++)h[f].latLng=e.unproject(h[f].pt);return h},projectPatternOnPointPath:function(a,b,c,d){var e=[],f=this.getPointPathPixelLength(a)*d,g=this.interpolateOnPointPath(a,b),h=c>0?this.getPointPathPixelLength(a)*c:0;if(e.push(g),d>0){var i=a;i=i.slice(g.predecessor),i[0]=g.pt;for(var j=this.getPointPathPixelLength(i);f<=j-h;)g=this.interpolateOnPointPath(i,f/j),e.push(g),i=i.slice(g.predecessor),i[0]=g.pt,j=this.getPointPathPixelLength(i)}return e},interpolateOnPointPath:function(a,b){var c=a.length;if(c<2)return null;if(b<=0)return{pt:a[0],predecessor:0,heading:this.computeAngle(a[0],a[1])};if(b>=1)return{pt:a[c-1],predecessor:c-1,heading:this.computeAngle(a[c-2],a[c-1])};if(2==c)return{pt:this.interpolateBetweenPoints(a[0],a[1],b),predecessor:0,heading:this.computeAngle(a[0],a[1])};for(var d=this.getPointPathPixelLength(a),e=a[0],f=e,g=0,h=0,i=0,j=1;j<c&&h<b;j++)e=f,g=h,f=a[j],i+=e.distanceTo(f),h=i/d;var k=(b-g)/(h-g);return{pt:this.interpolateBetweenPoints(e,f,k),predecessor:j-2,heading:this.computeAngle(e,f)}},interpolateBetweenPoints:function(a,b,c){return b.x!=a.x?new L.Point(a.x*(1-c)+c*b.x,a.y*(1-c)+c*b.y):new L.Point(a.x,a.y+(b.y-a.y)*c)}},L.PolylineDecorator=L.FeatureGroup.extend({options:{patterns:[]},initialize:function(a,b){L.FeatureGroup.prototype.initialize.call(this),L.Util.setOptions(this,b),this._map=null,this._initPaths(a),this._initPatterns()},_initPaths:function(a){this._paths=[];if(a instanceof L.Polyline)this._initPath(a.getLatLngs(),a instanceof L.Polygon);else if(L.Util.isArray(a)&&a.length>0)if(a[0]instanceof L.Polyline)for(var b=0;b<a.length;b++)this._initPath(a[b].getLatLngs(),a[b]instanceof L.Polygon);else this._initPath(a)},_isCoordArray:function(a){return L.Util.isArray(a)&&a.length>0&&(a[0]instanceof L.LatLng||L.Util.isArray(a[0])&&2==a[0].length&&"number"==typeof a[0][0])},_initPath:function(a,b){var c;c=this._isCoordArray(a)?[a]:a;for(var d=0;d<c.length;d++)b&&c[d].push(c[d][0]),this._paths.push(c[d])},_initPatterns:function(){this._isZoomDependant=!1,this._patterns=[];for(var a,b=0;b<this.options.patterns.length;b++)a=this._parsePatternDef(this.options.patterns[b]),this._patterns.push(a),this._isZoomDependant=this._isZoomDependant||a.isOffsetInPixels||a.isEndOffsetInPixels||a.isRepeatInPixels||a.symbolFactory.isZoomDependant},setPatterns:function(a){this.options.patterns=a,this._initPatterns(),this._softRedraw()},setPaths:function(a){this._initPaths(a),this.redraw()},_parsePatternDef:function(a,b){var c={cache:[],symbolFactory:a.symbol,isOffsetInPixels:!1,isEndOffsetInPixels:!1,isRepeatInPixels:!1};return"string"==typeof a.offset&&a.offset.indexOf("%")!=-1?c.offset=parseFloat(a.offset)/100:(c.offset=a.offset?parseFloat(a.offset):0,c.isOffsetInPixels=c.offset>0),"string"==typeof a.endOffset&&a.endOffset.indexOf("%")!=-1?c.endOffset=parseFloat(a.endOffset)/100:(c.endOffset=a.endOffset?parseFloat(a.endOffset):0,c.isEndOffsetInPixels=c.endOffset>0),"string"==typeof a.repeat&&a.repeat.indexOf("%")!=-1?c.repeat=parseFloat(a.repeat)/100:(c.repeat=parseFloat(a.repeat),c.isRepeatInPixels=c.repeat>0),c},onAdd:function(a){this._map=a,this._draw(),this._isZoomDependant&&this._map.on("zoomend",this._softRedraw,this)},onRemove:function(a){this._map.off("zoomend",this._softRedraw,this),this._map=null,L.LayerGroup.prototype.onRemove.call(this,a)},_buildSymbols:function(a,b,c){for(var d=[],e=0,f=c.length;e<f;e++)d.push(b.buildSymbol(c[e],a,this._map,e,f));return d},_getCache:function(a,b,c){var d=a.cache[b];return"undefined"==typeof d?(a.cache[b]=[],null):d[c]},_getDirectionPoints:function(a,b){var c=this._map.getZoom(),d=this._getCache(b,c,a);if(d)return d;var e,f,g,h=null,i=this._paths[a];return b.isOffsetInPixels?(h=L.LineUtil.PolylineDecorator.getPixelLength(i,this._map),e=b.offset/h):e=b.offset,b.isEndOffsetInPixels?(h=null!==h?h:L.LineUtil.PolylineDecorator.getPixelLength(i,this._map),f=b.endOffset/h):f=b.endOffset,b.isRepeatInPixels?(h=null!==h?h:L.LineUtil.PolylineDecorator.getPixelLength(i,this._map),g=b.repeat/h):g=b.repeat,d=L.LineUtil.PolylineDecorator.projectPatternOnPath(i,e,f,g,this._map),b.cache[c][a]=d,d},redraw:function(){this._redraw(!0)},_softRedraw:function(){this._redraw(!1)},_redraw:function(a){if(null!==this._map){if(this.clearLayers(),a)for(var b=0;b<this._patterns.length;b++)this._patterns[b].cache=[];this._draw()}},_drawPattern:function(a){for(var b,c,d=0;d<this._paths.length;d++){b=this._getDirectionPoints(d,a),c=this._buildSymbols(this._paths[d],a.symbolFactory,b);for(var e=0;e<c.length;e++)this.addLayer(c[e])}},_draw:function(){for(var a=0;a<this._patterns.length;a++)this._drawPattern(this._patterns[a])}}),L.polylineDecorator=function(a,b){return new L.PolylineDecorator(a,b)},L.RotatedMarker=L.Marker.extend({options:{angle:0},statics:{TRANSFORM_ORIGIN:L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"])},_initIcon:function(){L.Marker.prototype._initIcon.call(this),this._icon.style[L.RotatedMarker.TRANSFORM_ORIGIN]=this._getTransformOrigin()},_getTransformOrigin:function(){var a=this.options.icon.options.iconAnchor;return a?a[0]+"px "+a[1]+"px":"50% 50%"},_setPos:function(a){if(L.Marker.prototype._setPos.call(this,a),L.DomUtil.TRANSFORM)this._icon.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)";else if(L.Browser.ie){var b=this.options.angle*(Math.PI/180),c=Math.cos(b),d=Math.sin(b);this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+c+", M12="+-d+", M21="+d+", M22="+c+")"}},setAngle:function(a){this.options.angle=a}}),L.rotatedMarker=function(a,b){return new L.RotatedMarker(a,b)},L.Symbol=L.Symbol||{},L.Symbol.Dash=L.Class.extend({isZoomDependant:!0,options:{pixelSize:10,pathOptions:{}},initialize:function(a){L.Util.setOptions(this,a),this.options.pathOptions.clickable=!1},buildSymbol:function(a,b,c,d,e){var f=this.options,g=Math.PI/180;if(f.pixelSize<=1)return new L.Polyline([a.latLng,a.latLng],f.pathOptions);var h=c.project(a.latLng),i=-(a.heading-90)*g,j=new L.Point(h.x+f.pixelSize*Math.cos(i+Math.PI)/2,h.y+f.pixelSize*Math.sin(i)/2),k=h.add(h.subtract(j));return new L.Polyline([c.unproject(j),c.unproject(k)],f.pathOptions)}}),L.Symbol.dash=function(a){return new L.Symbol.Dash(a)},L.Symbol.ArrowHead=L.Class.extend({isZoomDependant:!0,options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(a){L.Util.setOptions(this,a),this.options.pathOptions.clickable=!1},buildSymbol:function(a,b,c,d,e){var f,g=this.options;return f=g.polygon?new L.Polygon(this._buildArrowPath(a,c),g.pathOptions):new L.Polyline(this._buildArrowPath(a,c),g.pathOptions)},_buildArrowPath:function(a,b){var c=Math.PI/180,d=b.project(a.latLng),e=-(a.heading-90)*c,f=this.options.headAngle/2*c,g=e+f,h=e-f,i=new L.Point(d.x-this.options.pixelSize*Math.cos(g),d.y+this.options.pixelSize*Math.sin(g)),j=new L.Point(d.x-this.options.pixelSize*Math.cos(h),d.y+this.options.pixelSize*Math.sin(h));return[b.unproject(i),a.latLng,b.unproject(j)]}}),L.Symbol.arrowHead=function(a){return new L.Symbol.ArrowHead(a)},L.Symbol.Marker=L.Class.extend({isZoomDependant:!1,options:{markerOptions:{},rotate:!1},initialize:function(a){L.Util.setOptions(this,a),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1,this.isZoomDependant=L.Browser.ie&&this.options.rotate},buildSymbol:function(a,b,c,d,e){return this.options.rotate?(this.options.markerOptions.angle=a.heading+(this.options.angleCorrection||0),new L.RotatedMarker(a.latLng,this.options.markerOptions)):new L.Marker(a.latLng,this.options.markerOptions)}}),L.Symbol.marker=function(a){return new L.Symbol.Marker(a)},L.LineUtil.PolylineDecorator={computeAngle:function(a,b){return 180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI+90},getPointPathPixelLength:function(a){var b=a.length;if(b<2)return 0;for(var c,d=0,e=a[0],f=1;f<b;f++)d+=e.distanceTo(c=a[f]),e=c;return d},getPixelLength:function(a,b){var c=a instanceof L.Polyline?a.getLatLngs():a,d=c.length;if(d<2)return 0;for(var e,f=0,g=b.project(c[0]),h=1;h<d;h++)f+=g.distanceTo(e=b.project(c[h])),g=e;return f},projectPatternOnPath:function(a,b,c,d,e){var f,g=[];for(f=0,l=a.length;f<l;f++)g[f]=e.project(a[f]);var h=this.projectPatternOnPointPath(g,b,c,d);for(f=0,l=h.length;f<l;f++)h[f].latLng=e.unproject(h[f].pt);return h},projectPatternOnPointPath:function(a,b,c,d){var e=[],f=this.getPointPathPixelLength(a)*d,g=this.interpolateOnPointPath(a,b),h=c>0?this.getPointPathPixelLength(a)*c:0;if(e.push(g),d>0){var i=a;i=i.slice(g.predecessor),i[0]=g.pt;for(var j=this.getPointPathPixelLength(i);f<=j-h;)g=this.interpolateOnPointPath(i,f/j),e.push(g),i=i.slice(g.predecessor),i[0]=g.pt,j=this.getPointPathPixelLength(i)}return e},interpolateOnPointPath:function(a,b){var c=a.length;if(c<2)return null;if(b<=0)return{pt:a[0],predecessor:0,heading:this.computeAngle(a[0],a[1])};if(b>=1)return{pt:a[c-1],predecessor:c-1,heading:this.computeAngle(a[c-2],a[c-1])};if(2==c)return{pt:this.interpolateBetweenPoints(a[0],a[1],b),predecessor:0,heading:this.computeAngle(a[0],a[1])};for(var d=this.getPointPathPixelLength(a),e=a[0],f=e,g=0,h=0,i=0,j=1;j<c&&h<b;j++)e=f,g=h,f=a[j],i+=e.distanceTo(f),h=i/d;var k=(b-g)/(h-g);return{pt:this.interpolateBetweenPoints(e,f,k),predecessor:j-2,
heading:this.computeAngle(e,f)}},interpolateBetweenPoints:function(a,b,c){return b.x!=a.x?new L.Point(a.x*(1-c)+c*b.x,a.y*(1-c)+c*b.y):new L.Point(a.x,a.y+(b.y-a.y)*c)}},L.PolylineDecorator=L.FeatureGroup.extend({options:{patterns:[]},initialize:function(a,b){L.FeatureGroup.prototype.initialize.call(this),L.Util.setOptions(this,b),this._map=null,this._initPaths(a),this._initPatterns()},_initPaths:function(a){this._paths=[];if(a instanceof L.Polyline)this._initPath(a.getLatLngs(),a instanceof L.Polygon);else if(L.Util.isArray(a)&&a.length>0)if(a[0]instanceof L.Polyline)for(var b=0;b<a.length;b++)this._initPath(a[b].getLatLngs(),a[b]instanceof L.Polygon);else this._initPath(a)},_isCoordArray:function(a){return L.Util.isArray(a)&&a.length>0&&(a[0]instanceof L.LatLng||L.Util.isArray(a[0])&&2==a[0].length&&"number"==typeof a[0][0])},_initPath:function(a,b){var c;c=this._isCoordArray(a)?[a]:a;for(var d=0;d<c.length;d++)b&&c[d].push(c[d][0]),this._paths.push(c[d])},_initPatterns:function(){this._isZoomDependant=!1,this._patterns=[];for(var a,b=0;b<this.options.patterns.length;b++)a=this._parsePatternDef(this.options.patterns[b]),this._patterns.push(a),this._isZoomDependant=this._isZoomDependant||a.isOffsetInPixels||a.isEndOffsetInPixels||a.isRepeatInPixels||a.symbolFactory.isZoomDependant},setPatterns:function(a){this.options.patterns=a,this._initPatterns(),this._softRedraw()},setPaths:function(a){this._initPaths(a),this.redraw()},_parsePatternDef:function(a,b){var c={cache:[],symbolFactory:a.symbol,isOffsetInPixels:!1,isEndOffsetInPixels:!1,isRepeatInPixels:!1};return"string"==typeof a.offset&&a.offset.indexOf("%")!=-1?c.offset=parseFloat(a.offset)/100:(c.offset=a.offset?parseFloat(a.offset):0,c.isOffsetInPixels=c.offset>0),"string"==typeof a.endOffset&&a.endOffset.indexOf("%")!=-1?c.endOffset=parseFloat(a.endOffset)/100:(c.endOffset=a.endOffset?parseFloat(a.endOffset):0,c.isEndOffsetInPixels=c.endOffset>0),"string"==typeof a.repeat&&a.repeat.indexOf("%")!=-1?c.repeat=parseFloat(a.repeat)/100:(c.repeat=parseFloat(a.repeat),c.isRepeatInPixels=c.repeat>0),c},onAdd:function(a){this._map=a,this._draw(),this._isZoomDependant&&this._map.on("zoomend",this._softRedraw,this)},onRemove:function(a){this._map.off("zoomend",this._softRedraw,this),this._map=null,L.LayerGroup.prototype.onRemove.call(this,a)},_buildSymbols:function(a,b,c){for(var d=[],e=0,f=c.length;e<f;e++)d.push(b.buildSymbol(c[e],a,this._map,e,f));return d},_getCache:function(a,b,c){var d=a.cache[b];return"undefined"==typeof d?(a.cache[b]=[],null):d[c]},_getDirectionPoints:function(a,b){var c=this._map.getZoom(),d=this._getCache(b,c,a);if(d)return d;var e,f,g,h=null,i=this._paths[a];return b.isOffsetInPixels?(h=L.LineUtil.PolylineDecorator.getPixelLength(i,this._map),e=b.offset/h):e=b.offset,b.isEndOffsetInPixels?(h=null!==h?h:L.LineUtil.PolylineDecorator.getPixelLength(i,this._map),f=b.endOffset/h):f=b.endOffset,b.isRepeatInPixels?(h=null!==h?h:L.LineUtil.PolylineDecorator.getPixelLength(i,this._map),g=b.repeat/h):g=b.repeat,d=L.LineUtil.PolylineDecorator.projectPatternOnPath(i,e,f,g,this._map),b.cache[c][a]=d,d},redraw:function(){this._redraw(!0)},_softRedraw:function(){this._redraw(!1)},_redraw:function(a){if(null!==this._map){if(this.clearLayers(),a)for(var b=0;b<this._patterns.length;b++)this._patterns[b].cache=[];this._draw()}},_drawPattern:function(a){for(var b,c,d=0;d<this._paths.length;d++){b=this._getDirectionPoints(d,a),c=this._buildSymbols(this._paths[d],a.symbolFactory,b);for(var e=0;e<c.length;e++)this.addLayer(c[e])}},_draw:function(){for(var a=0;a<this._patterns.length;a++)this._drawPattern(this._patterns[a])}}),L.polylineDecorator=function(a,b){return new L.PolylineDecorator(a,b)},L.RotatedMarker=L.Marker.extend({options:{angle:0},statics:{TRANSFORM_ORIGIN:L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"])},_initIcon:function(){L.Marker.prototype._initIcon.call(this),this._icon.style[L.RotatedMarker.TRANSFORM_ORIGIN]=this._getTransformOrigin()},_getTransformOrigin:function(){var a=this.options.icon.options.iconAnchor;return a?a[0]+"px "+a[1]+"px":"50% 50%"},_setPos:function(a){if(L.Marker.prototype._setPos.call(this,a),L.DomUtil.TRANSFORM)this._icon.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)";else if(L.Browser.ie){var b=this.options.angle*(Math.PI/180),c=Math.cos(b),d=Math.sin(b);this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+c+", M12="+-d+", M21="+d+", M22="+c+")"}},setAngle:function(a){this.options.angle=a}}),L.rotatedMarker=function(a,b){return new L.RotatedMarker(a,b)},L.Symbol=L.Symbol||{},L.Symbol.Dash=L.Class.extend({isZoomDependant:!0,options:{pixelSize:10,pathOptions:{}},initialize:function(a){L.Util.setOptions(this,a),this.options.pathOptions.clickable=!1},buildSymbol:function(a,b,c,d,e){var f=this.options,g=Math.PI/180;if(f.pixelSize<=1)return new L.Polyline([a.latLng,a.latLng],f.pathOptions);var h=c.project(a.latLng),i=-(a.heading-90)*g,j=new L.Point(h.x+f.pixelSize*Math.cos(i+Math.PI)/2,h.y+f.pixelSize*Math.sin(i)/2),k=h.add(h.subtract(j));return new L.Polyline([c.unproject(j),c.unproject(k)],f.pathOptions)}}),L.Symbol.dash=function(a){return new L.Symbol.Dash(a)},L.Symbol.ArrowHead=L.Class.extend({isZoomDependant:!0,options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(a){L.Util.setOptions(this,a),this.options.pathOptions.clickable=!1},buildSymbol:function(a,b,c,d,e){var f,g=this.options;return f=g.polygon?new L.Polygon(this._buildArrowPath(a,c),g.pathOptions):new L.Polyline(this._buildArrowPath(a,c),g.pathOptions)},_buildArrowPath:function(a,b){var c=Math.PI/180,d=b.project(a.latLng),e=-(a.heading-90)*c,f=this.options.headAngle/2*c,g=e+f,h=e-f,i=new L.Point(d.x-this.options.pixelSize*Math.cos(g),d.y+this.options.pixelSize*Math.sin(g)),j=new L.Point(d.x-this.options.pixelSize*Math.cos(h),d.y+this.options.pixelSize*Math.sin(h));return[b.unproject(i),a.latLng,b.unproject(j)]}}),L.Symbol.arrowHead=function(a){return new L.Symbol.ArrowHead(a)},L.Symbol.Marker=L.Class.extend({isZoomDependant:!1,options:{markerOptions:{},rotate:!1},initialize:function(a){L.Util.setOptions(this,a),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1,this.isZoomDependant=L.Browser.ie&&this.options.rotate},buildSymbol:function(a,b,c,d,e){return this.options.rotate?(this.options.markerOptions.angle=a.heading+(this.options.angleCorrection||0),new L.RotatedMarker(a.latLng,this.options.markerOptions)):new L.Marker(a.latLng,this.options.markerOptions)}}),L.Symbol.marker=function(a){return new L.Symbol.Marker(a)},function(a,b,c){"use strict";var d={iconColor:"#1EB300",iconAnchor:{marker:[14,36],circle:[11,10],"circle-dot":[5,5],"rectangle-dot":[5,6],doughnut:[8,8]},popupAnchor:{marker:[0,-25],circle:[-3,-76],"circle-dot":[0,-2],"rectangle-dot":[0,-2],doughnut:[0,-2]},innerIconAnchor:{marker:[-2,5],circle:[0,2]},iconSize:{marker:[28,28],circle:[22,22],"circle-dot":[2,2],"rectangle-dot":[2,2],doughnut:[15,15]}};L.BeautifyIcon={Icon:L.Icon.extend({options:{icon:"leaf",iconSize:d.iconSize.circle,iconAnchor:d.iconAnchor.circle,iconShape:"circle",iconStyle:"",innerIconAnchor:[0,3],innerIconStyle:"",isAlphaNumericIcon:!1,text:1,borderColor:d.iconColor,borderWidth:2,borderStyle:"solid",backgroundColor:"white",textColor:d.iconColor,customClasses:"",spin:!1,prefix:"fa",html:""},initialize:function(a){this.applyDefaults(a),this.options=L.Util.setOptions(this,a)},applyDefaults:function(a){a&&(!a.iconSize&&a.iconShape&&(a.iconSize=d.iconSize[a.iconShape]),!a.iconAnchor&&a.iconShape&&(a.iconAnchor=d.iconAnchor[a.iconShape]),!a.popupAnchor&&a.iconShape&&(a.popupAnchor=d.popupAnchor[a.iconShape]),a.innerIconAnchor||"circle"!==a.iconShape&&"marker"!==a.iconShape||("circle"===a.iconShape&&a.isAlphaNumericIcon?a.innerIconAnchor=[0,-1]:"marker"!==a.iconShape||a.isAlphaNumericIcon||(a.innerIconAnchor=d.innerIconAnchor[a.iconShape])))},createIcon:function(){var a=b.createElement("div"),c=this.options;return a.innerHTML=c.html?c.html:this.createIconInnerHtml(),this._setIconStyles(a),a},createIconInnerHtml:function(){var a=this.options;if("circle-dot"===a.iconShape||"rectangle-dot"===a.iconShape||"doughnut"===a.iconShape)return"";var b=this.getInnerIconStyle(a);if(a.isAlphaNumericIcon)return'<div style="'+b+'">'+a.text+"</div>";var c="";return a.spin&&(c=" fa-spin"),'<i class="'+a.prefix+" "+a.prefix+"-"+a.icon+c+'" style="'+b+'"></i>'},getInnerIconStyle:function(a){var b=L.point(a.innerIconAnchor);return"color:"+a.textColor+";margin-top:"+b.y+"px; margin-left:"+b.x+"px;"+a.innerIconStyle},_setIconStyles:function(a){var b=this.options,c=L.point(b.iconSize),d=L.point(b.iconAnchor);if(a.className="beautify-marker ",b.iconShape&&(a.className+=b.iconShape),b.customClasses&&(a.className+=" "+b.customClasses),a.style.backgroundColor=b.backgroundColor,a.style.color=b.textColor,a.style.borderColor=b.borderColor,a.style.borderWidth=b.borderWidth+"px",a.style.borderStyle=b.borderStyle,c&&(a.style.width=c.x+"px",a.style.height=c.y+"px"),d&&(a.style.marginLeft=-d.x+"px",a.style.marginTop=-d.y+"px"),b.iconStyle){var e=a.getAttribute("style");e+=b.iconStyle,a.setAttribute("style",e)}}})},L.BeautifyIcon.icon=function(a){return new L.BeautifyIcon.Icon(a)}}(this,document),L.BeautifyMarker=L.Marker.extend({registerMapZoomendEvent:!1,options:{icon:L.BeautifyIcon.icon()},onAdd:function(a){if(L.Marker.prototype.onAdd.call(this,a),this.options&&this.options.icon&&this.options.icon.options&&"marker"===this.options.icon.options.iconShape){var b=this._icon;this._updateMarkerShapeIcon(b),this.registerMapZoomendEvent||(L.DomEvent.addListener(a,"zoomend",this._onMapZoomChange,this),L.DomEvent.addListener(this,"drag",this._onMarkerDrag,this),this.registerMapZoomendEvent=!0)}},_onMarkerDrag:function(){this._updateMarkerShapeIcon(this._icon)},_onMapZoomChange:function(){for(var a=document.getElementsByClassName("marker"),b=0,c=a.length;b<c;b++){var d=a[b];this._updateMarkerShapeIcon(d)}},_updateMarkerShapeIcon:function(a){var b=a.style.transform;a.style.transform=b+" rotate(45deg)",a.firstChild.style.transform="rotate(315deg)"}}),L.BeautifyMarker.marker=function(a,b){return new L.BeautifyMarker(a,b)};